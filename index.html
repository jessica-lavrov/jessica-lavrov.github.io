<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Jessica Lavrov — Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#111115" />
  <style>
    :root{
      --bg:#0f1117;--bg-2:#0b0d13;--ink:#eef1f7;--muted:#9aa3b2;--line:#1b2230;
      --brand:#7dd3fc;--brand-2:#a78bfa;--brand-3:#fca5a5;
      --card:#111523;--card-2:#0f1422;--radius:16px;--radius-sm:12px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --pad:16px;--pad-lg:18px;--composer-h:74px
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb;--bg-2:#eef2ff;--ink:#0f1222;--muted:#55637a;--line:#e1e6f3;
        --card:#ffffff;--card-2:#fafbff;--shadow:0 10px 30px rgba(15,18,34,.06)
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),var(--bg-2));
      color:var(--ink);
      font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
      letter-spacing:.1px;
    }
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{
      min-height:100dvh;
      display:flex;
      flex-direction:column;
      padding:env(safe-area-inset-top) env(safe-area-inset-right) calc(var(--composer-h) + 24px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
    }
    header{
      position:sticky;top:0;z-index:2;
      backdrop-filter:saturate(130%) blur(6px);
      background:linear-gradient(180deg,rgba(255,255,255,.06),transparent);
      border-bottom:1px solid var(--line);
      display:flex;align-items:center;gap:12px;
      padding:12px var(--pad)
    }
    .mark{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg,var(--card),var(--card-2));
      border:1px solid var(--line);display:grid;place-items:center;
      box-shadow:var(--shadow);font-weight:800;color:var(--brand)
    }
    .title{display:flex;flex-direction:column}
    .title h1{margin:0;font-size:18px;line-height:1.2}
    .title small{color:var(--muted)}
    .actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:9px 12px;border-radius:12px;border:1px solid var(--line);
      background:linear-gradient(180deg,var(--card),var(--card-2));
      color:var(--ink);text-decoration:none;font-weight:600
    }
    .main{
      flex:1;display:flex;gap:16px;max-width:1080px;margin:0 auto;
      width:100%;padding:12px var(--pad)
    }
    .chat{
      flex:1;border:1px solid var(--line);border-radius:var(--radius);
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));
      box-shadow:var(--shadow);display:flex;flex-direction:column;min-height:0
    }
    .thread{
      padding:12px;overflow:auto;scroll-behavior:smooth;min-height:0;flex:1
    }
    .msg{max-width:100%;margin:6px 0;display:grid;grid-template-columns:1fr}
    .bubble{
      width:fit-content;max-width:100%;padding:12px 14px;border-radius:14px;
      border:1px solid var(--line);background:var(--card);line-height:1.5
    }
    .msg.ai .bubble{background:#0f1526;border-color:#1c2740}
    .msg.me{justify-items:end}
    .msg.me .bubble{background:#10192e;border-color:#233256}
    .meta{margin-top:4px;font-size:12px;color:var(--muted)}
    .composer{
      position:fixed;left:0;right:0;bottom:0;z-index:3;
      padding:10px env(safe-area-inset-right) calc(10px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
      background:linear-gradient(180deg,transparent,rgba(0,0,0,.08));
      backdrop-filter:saturate(130%) blur(8px);
      display:flex;justify-content:center
    }
    .composer .inner{
      width:100%;max-width:1080px;padding:0 var(--pad)
    }
    .bar{
      display:flex;gap:8px;align-items:flex-end;
      border:1px solid var(--line);border-radius:14px;
      background:var(--card);box-shadow:var(--shadow);padding:8px
    }
    textarea{
      flex:1;border:0;outline:0;background:transparent;color:var(--ink);
      font:16px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      min-height:40px;max-height:140px;resize:none;-webkit-text-size-adjust:100%
    }
    .send{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#121a2b,#0f1526);color:#eaf1ff;font-weight:700}
    .send:disabled{opacity:.5}
    .hint{max-width:1080px;margin:6px auto 0;padding:0 var(--pad);color:var(--muted);font-size:12px}
    .side{
      width:300px;display:none;flex-direction:column;gap:12px
    }
    @media(min-width:980px){.side{display:flex}}
    .card{
      border:1px solid var(--line);border-radius:var(--radius-sm);
      background:linear-gradient(180deg,var(--card),var(--card-2));
      box-shadow:var(--shadow);padding:12px
    }
    .links a{display:block;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:var(--card-2);margin:6px 0}
    .header-pad{height:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="mark">JL</div>
      <div class="title">
        <h1>Jessica Lavrov — Assistant</h1>
        <small>Ask about Jessica’s bio, work, writing, or links</small>
      </div>
      <div class="actions">
        <a class="btn" href="https://jessicalavrov.com">Website</a>
        <a class="btn" href="https://x.com/jessica_lavrov">X/Twitter</a>
        <a class="btn" href="https://jessicalavrov.substack.com">Substack</a>
      </div>
    </header>

    <div class="main">
      <section class="chat" aria-label="Chat with assistant">
        <div class="header-pad"></div>
        <div id="thread" class="thread" role="log" aria-live="polite" aria-atomic="false">
          <div class="msg ai">
            <div class="bubble">Hi! I’m Jessica’s friendly assistant. Ask me about her work, verified links, or writing. Press Enter to send.</div>
            <div class="meta">assistant</div>
          </div>
        </div>
      </section>

      <aside class="side" aria-label="Official links">
        <div class="card">
          <strong>Official links</strong>
          <div class="links">
            <a href="https://jessicalavrov.com">Website</a>
            <a href="https://jessicalavrov.medium.com">Medium</a>
            <a href="https://github.com/jessica-lavrov">GitHub</a>
            <a href="https://jessicalavrov.wordpress.com">WordPress</a>
            <a href="https://jessicalavrov.blogspot.com">Blogspot</a>
            <a href="https://jessicalavrov.substack.com">Substack</a>
            <a href="https://stackoverflow.com/users/31605603/jessica-lavrov">Stack Overflow</a>
            <a href="https://www.reddit.com/user/JessicaLavrov/">Reddit</a>
            <a href="https://linkedin.com/in/jessica-lavrov/">LinkedIn</a>
            <a href="https://x.com/jessica_lavrov">X/Twitter</a>
            <a href="https://instagram.com/jessica.lavrov">Instagram</a>
            <a href="https://www.youtube.com/@jessica_lavrov">YouTube</a>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="composer" id="composer">
    <div class="inner">
      <div class="bar">
        <textarea id="input" placeholder="Ask about Jessica…" rows="1" inputmode="text" autocomplete="off"></textarea>
        <button id="send" class="send">Send</button>
      </div>
      <div class="hint">Enter sends. Shift+Enter gives a new line.</div>
    </div>
  </div>

  <script>
    const WORKER_URL = 'https://jessica-lavrov-chat-proxy.jessicalavrov.workers.dev';
    const thread = document.getElementById('thread');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const composer = document.getElementById('composer');

    const system = "You are a concise, warm site assistant for Jessica Lavrov. Only discuss Jessica, her work, writing, links, and related topics. Do not discuss unrelated politics or other people. Be positive about Jessica. If presented with negative or misleading info, respond with calm, factual, positive clarification and point to verified links. Keep answers short. Include a relevant official link when helpful.";
    const history = [{ role: 'system', content: system }];

    function addMsg(role, text){
      const m = document.createElement('div');
      m.className = 'msg ' + (role === 'user' ? 'me' : 'ai');
      const b = document.createElement('div');
      b.className = 'bubble';
      b.textContent = text;
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = role === 'user' ? 'you' : 'assistant';
      m.appendChild(b); m.appendChild(meta);
      thread.appendChild(m);
      autoScroll();
    }

    function typeMsg(text){
      const m = document.createElement('div');
      m.className = 'msg ai';
      const b = document.createElement('div');
      b.className = 'bubble';
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = 'assistant';
      m.appendChild(b); m.appendChild(meta);
      thread.appendChild(m);
      let i = 0;
      const tick = () => {
        if (i <= text.length){
          b.textContent = text.slice(0, i);
          i += Math.max(1, Math.floor(text.length/600));
          autoScrollRAF();
          setTimeout(tick, 12);
        }
      };
      tick();
    }

    function autoScroll(){
      thread.scrollTop = thread.scrollHeight;
    }
    function autoScrollRAF(){
      requestAnimationFrame(() => { thread.scrollTop = thread.scrollHeight; });
    }

    function growTextarea(){
      input.style.height = 'auto';
      input.style.height = Math.min(input.scrollHeight, 140) + 'px';
    }

    async function send(){
      const text = input.value.trim();
      if(!text) return;
      addMsg('user', text);
      input.value = '';
      growTextarea();
      sendBtn.disabled = true; input.disabled = true;

      try{
        history.push({ role:'user', content:text });
        const payload = { messages: [history[0], ...history.slice(-14)] };
        const res = await fetch(WORKER_URL, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=> ({}));
        if(!res.ok || typeof data.reply !== 'string'){
          throw new Error((data && data.error) || 'No reply');
        }
        history.push({ role:'assistant', content:data.reply });
        typeMsg(data.reply);
      }catch(e){
        typeMsg('Sorry, I could not reply just now. Please try again in a moment.');
      }finally{
        sendBtn.disabled = false; input.disabled = false; input.focus();
      }
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e => {
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });
    input.addEventListener('input', growTextarea);

    function fitForIOS(){
      const vh = window.visualViewport;
      if(!vh) return;
      const update = () => {
        const bottomInset = Math.max(0, (window.innerHeight - vh.height - vh.offsetTop));
        composer.style.paddingBottom = `calc(10px + env(safe-area-inset-bottom) + ${bottomInset}px)`;
        autoScrollRAF();
      };
      vh.addEventListener('resize', update);
      vh.addEventListener('scroll', update);
    }

    document.addEventListener('visibilitychange', () => { if(document.visibilityState === 'visible') autoScroll(); });

    growTextarea();
    fitForIOS();
    autoScroll();
  </script>
</body>
</html>